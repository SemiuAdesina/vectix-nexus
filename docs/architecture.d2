direction: down

title: |md
  # Vectix Nexus — System Architecture
| { near: top-center }

classes: {
  layer: {
    style: {
      fill: "#f8fafc"
      stroke: "#94a3b8"
      border-radius: 10
      font-size: 18
      bold: true
    }
  }
  box: {
    style: {
      fill: "#ffffff"
      stroke: "#cbd5e1"
      border-radius: 6
      font-size: 13
    }
  }
  ext: {
    style: {
      fill: "#eef2ff"
      stroke: "#6366f1"
      border-radius: 6
      font-size: 13
      font-color: "#3730a3"
    }
  }
}

# ── 1. Clients ────────────────────────────────────────────

clients: "1  CLIENT LAYER" {
  class: layer
  grid-columns: 2

  frontend: |md
    **Next.js Frontend**
    Dashboard · Agents · Billing
    Marketplace · Advanced
    On-chain · Governance · Threats
  | { class: box }

  m2m: |md
    **M2M / API Clients**
    REST API (v1)
    Webhook Consumers
  | { class: box }
}

# ── 2. Auth ───────────────────────────────────────────────

gateway: "2  AUTH & API GATEWAY" {
  class: layer
  grid-columns: 3

  clerk: "Clerk Auth\nJWT · Identity" { class: box }
  api-keys: "API Key Service\nvx_* · Scopes · Tiers" { class: box }
  middleware: "Express Middleware\nCORS · Rate Limit\nSecurity Headers" { class: box }
}

# ── 3. Business Logic ─────────────────────────────────────

business: "3  BUSINESS LOGIC" {
  class: layer
  grid-columns: 2

  core: |md
    **Core**
    Agents · Wallet
    Trading · Fly Deploy
  | { class: box }

  monetization: |md
    **Monetization**
    Stripe · Subscriptions
    Affiliate · Marketplace
  | { class: box }

  security: |md
    **Security & Compliance**
    Token Security · Trust Score
    OFAC · AML · Geo-block
    MEV · Whitelist · Lockout
  | { class: box }

  advanced: |md
    **Advanced**
    Preflight · Tx Simulator
    Supervisor Rules
    Shadow Mode · TEE
    Narrative · Signals
  | { class: box }

  api-mgmt: |md
    **API Management**
    Public API · Webhooks
    Bug Bounty
  | { class: box }
}

# ── 4. On-chain ───────────────────────────────────────────

onchain: "4  ON-CHAIN LAYER" {
  class: layer
  grid-columns: 4

  verification: "Verification" { class: box }
  multisig: "Multi-sig" { class: box }
  circuit: "Circuit Breaker" { class: box }
  governance: "Governance" { class: box }
  audit: "Audit Trail" { class: box }
  timelock: "Time-lock" { class: box }
  scanning: "Security Scan" { class: box }
  threat: "Threat Intel" { class: box }
}

# ── 5. Data ───────────────────────────────────────────────

data: "5  DATA LAYER" {
  class: layer
  grid-columns: 2

  prisma: "Prisma ORM\nType-safe · Pooled" { class: box }
  postgres: "PostgreSQL\nUsers · Agents · Keys\nAudit · Rules · Referrals" { class: box }
}

# ── 6. External Services ─────────────────────────────────

external: "6  EXTERNAL SERVICES" {
  class: layer
  grid-columns: 3

  fly: "Fly.io\nAgent Hosting" { class: ext }
  stripe: "Stripe\nPayments" { class: ext }
  solana: "Solana RPC\nHelius / Alchemy" { class: ext }
  dexscreener: "DexScreener\nToken Data" { class: ext }
  rugcheck: "RugCheck\nRug Analysis" { class: ext }
  goplus: "GoPlus\nSecurity Data" { class: ext }
  lunarcrush: "LunarCrush\nSocial Intel" { class: ext }
  phala: "Phala Network\nTEE Provider" { class: ext }
  clerk-ext: "Clerk\nUser Auth" { class: ext }
}

# ── 7. Infrastructure ─────────────────────────────────────

infra: "7  INFRASTRUCTURE & CI/CD" {
  class: layer
  grid-columns: 3

  ci: "GitHub Actions\nCI · Quality · Security\nDeploy · Migrate · Release" { class: box }
  docker: "Docker\nBackend · Frontend\nEliza Agent" { class: box }
  ghcr: "GHCR\nContainer Registry" { class: box }
}

# ── Connections (strict vertical flow) ────────────────────

clients -> gateway: "HTTPS / JWT / API Key" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
gateway -> business: "Authenticated requests" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
business -> onchain: "On-chain ops" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
business -> data: "Read / Write" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
onchain -> data: "Persist state" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
data -> external: "API calls & blockchain tx" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
external -> infra: "Deployed via" {
  style.stroke: "#6366f1"
  style.font-size: 11
}
