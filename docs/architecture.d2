direction: down

title: "VECTIX NEXUS — SYSTEM ARCHITECTURE" {
  near: top-center
  style.font-size: 48
  style.font-color: "#0f172a"
  style.bold: true
  style.underline: true
}

# ── 1. Clients ────────────────────────────────────────────

clients: "CLIENT LAYER" {
  style.fill: "#ecfdf5"
  style.stroke: "#059669"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#064e3b"

  frontend: "Next.js Frontend\nDashboard · Agents · Billing · Marketplace\nAdvanced Features · On-chain · Governance · Threats" {
    style.fill: "#ffffff"
    style.stroke: "#059669"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#064e3b"
    style.bold: true
  }

  m2m: "M2M / API Clients\nREST API (v1) · Webhook Consumers" {
    style.fill: "#ffffff"
    style.stroke: "#059669"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#064e3b"
    style.bold: true
  }

  frontend -> m2m: {style.opacity: 0}
}

# ── 2. Auth & Gateway ─────────────────────────────────────

gateway: "AUTH & API GATEWAY" {
  style.fill: "#eff6ff"
  style.stroke: "#2563eb"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#1e3a8a"

  clerk: "Clerk Auth\nJWT Verification · User Identity" {
    style.fill: "#ffffff"
    style.stroke: "#2563eb"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#1e3a8a"
    style.bold: true
  }

  keys: "API Key Service\nScoped Access (vx_*) · Tier-based Rate Limits" {
    style.fill: "#ffffff"
    style.stroke: "#2563eb"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#1e3a8a"
    style.bold: true
  }

  mw: "Express Middleware\nCORS · Rate Limiter · Security Headers" {
    style.fill: "#ffffff"
    style.stroke: "#2563eb"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#1e3a8a"
    style.bold: true
  }

  clerk -> keys: {style.opacity: 0}
  keys -> mw: {style.opacity: 0}
}

# ── 3. Business Logic ─────────────────────────────────────

business: "BUSINESS LOGIC" {
  style.fill: "#faf5ff"
  style.stroke: "#7c3aed"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#4c1d95"

  core: "Core Services\nAgents · Wallet · Trading\nFly Deploy & Lifecycle" {
    style.fill: "#ffffff"
    style.stroke: "#7c3aed"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#4c1d95"
    style.bold: true
  }

  money: "Monetization\nStripe · Subscriptions\nAffiliate · Marketplace" {
    style.fill: "#ffffff"
    style.stroke: "#7c3aed"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#4c1d95"
    style.bold: true
  }

  sec: "Security & Compliance\nToken Security · Trust Score\nOFAC · AML · Geo-block\nMEV · Whitelist · Lockout" {
    style.fill: "#ffffff"
    style.stroke: "#7c3aed"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#4c1d95"
    style.bold: true
  }

  adv: "Advanced Features\nPreflight · Tx Simulator\nSupervisor · Shadow Mode\nTEE · Narrative · Signals" {
    style.fill: "#ffffff"
    style.stroke: "#7c3aed"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#4c1d95"
    style.bold: true
  }

  api: "API Management\nPublic API · Webhooks\nBug Bounty" {
    style.fill: "#ffffff"
    style.stroke: "#7c3aed"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#4c1d95"
    style.bold: true
  }

  core -> money: {style.opacity: 0}
  sec -> adv: {style.opacity: 0}
}

# ── 4. On-chain ───────────────────────────────────────────

onchain: "ON-CHAIN LAYER" {
  style.fill: "#fff7ed"
  style.stroke: "#ea580c"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#7c2d12"
  grid-columns: 4

  a: Verification {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  b: "Circuit Breaker" {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  c: "Audit Trail" {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  d: "Security Scan" {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  e: "Multi-sig" {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  f: Governance {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  g: "Time-lock" {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
  h: "Threat Intel" {
    style.fill: "#ffffff"
    style.stroke: "#ea580c"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7c2d12"
    style.bold: true
  }
}

# ── 5. Data ───────────────────────────────────────────────

data: "DATA LAYER" {
  style.fill: "#fef2f2"
  style.stroke: "#dc2626"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#7f1d1d"

  prisma: "Prisma ORM\nType-safe Queries · Connection Pool" {
    style.fill: "#ffffff"
    style.stroke: "#dc2626"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7f1d1d"
    style.bold: true
  }

  pg: "PostgreSQL\nUsers · Agents · Strategies\nAPI Keys · Audit Events\nSupervisor Rules · Referrals" {
    style.fill: "#ffffff"
    style.stroke: "#dc2626"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#7f1d1d"
    style.bold: true
  }

  prisma -> pg: {style.opacity: 0}
}

# ── 6. External Services ─────────────────────────────────

external: "EXTERNAL SERVICES" {
  style.fill: "#f0f9ff"
  style.stroke: "#0284c7"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#0c4a6e"
  grid-columns: 3

  fly: "Fly.io\nAgent Hosting" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  stripe: "Stripe\nPayments" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  solana: "Solana RPC\nHelius / Alchemy" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  dex: "DexScreener\nToken Data" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  rug: "RugCheck\nRug Analysis" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  goplus: "GoPlus\nSecurity Data" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  lunar: "LunarCrush\nSocial Intel" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  phala: "Phala Network\nTEE Provider" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
  clerk: "Clerk\nUser Auth" {
    style.fill: "#e0f2fe"
    style.stroke: "#0284c7"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#0c4a6e"
    style.bold: true
  }
}

# ── 7. Infrastructure ─────────────────────────────────────

infra: "INFRASTRUCTURE & CI/CD" {
  style.fill: "#f5f5f4"
  style.stroke: "#57534e"
  style.stroke-width: 3
  style.border-radius: 14
  style.font-size: 36
  style.bold: true
  style.font-color: "#1c1917"

  ci: "GitHub Actions\nCI · Code Quality · Security\nDeploy · Migrations · Release" {
    style.fill: "#ffffff"
    style.stroke: "#57534e"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#1c1917"
    style.bold: true
  }

  docker: "Docker\nBackend · Frontend\nEliza Agent Images" {
    style.fill: "#ffffff"
    style.stroke: "#57534e"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#1c1917"
    style.bold: true
  }

  ghcr: "GHCR\nGitHub Container Registry" {
    style.fill: "#ffffff"
    style.stroke: "#57534e"
    style.stroke-width: 2
    style.border-radius: 10
    style.font-size: 26
    style.font-color: "#1c1917"
    style.bold: true
  }

  ci -> docker: {style.opacity: 0}
  docker -> ghcr: {style.opacity: 0}
}

# ── Connections ───────────────────────────────────────────

clients -> gateway: "HTTPS / JWT / API Key" {
  style.stroke: "#059669"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#064e3b"
  style.bold: true
}

gateway -> business: "Authenticated Requests" {
  style.stroke: "#2563eb"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#1e3a8a"
  style.bold: true
}

business -> onchain: "On-chain Operations" {
  style.stroke: "#7c3aed"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#4c1d95"
  style.bold: true
}

business -> data: "Read / Write" {
  style.stroke: "#7c3aed"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#4c1d95"
  style.bold: true
}

onchain -> data: "Persist Proofs" {
  style.stroke: "#ea580c"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#7c2d12"
  style.bold: true
}

data -> external: "API Calls & Blockchain Tx" {
  style.stroke: "#dc2626"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#7f1d1d"
  style.bold: true
}

external -> infra: "Deployed via CI/CD" {
  style.stroke: "#0284c7"
  style.stroke-width: 4
  style.font-size: 24
  style.font-color: "#0c4a6e"
  style.bold: true
}
